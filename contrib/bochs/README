Running Etherboot within Bochs
==============================

Michael Brown <mbrown@fensystems.co.uk>
Based on an idea suggested by H. Peter Anvin <hpa@zytor.com>.

$Id$

Bochs is a program that simulates a complete Intel x86 computer,
including hardware.  It can be used to test Etherboot.

To get bochs running you will need:

1. An installation of bochs.  If you are running Mandrake, the bochs
   RPM included in contribs works and, at the time of writing (January
   2004), is up to date.

2. Kernel TUN/TAP support.  You probably have this already.  Try
   running "modprobe tun".  It should succeed and you should see a
   device /dev/net/tun.

3. Write access to /dev/net/tun.  You can do this by running bochs as
   root, but only if you're feel like living dangerously.  A safer way
   is to change the permissions on /dev/net/tun so that you can write
   to it as your ordinary user.  For example "chown me /dev/net/tun"
   will work if your username is "me".

4. If you want to avoid being prompted for the root password every
   time you start bochs, make the script "ifup.tun" in this directory
   setuid-root.  If you don't know how to do this, don't do it.

5. An Etherboot ROM image.  By default, bochs will use the file
   "ne.zrom" in the Etherboot build directory (i.e. src/bin/ne.zrom).
   Bochs emulates only an NE2000 ISA NIC, so this is practically the
   only image that can be used.  You will need to make sure that it is
   built before starting bochs by running "make bin/ne.zrom" in the
   src directory.

That should be all that is required.  Start bochs by running "bochs"
(*not* as root).  Choose option 5 to start simulation.  You should see
Etherboot start up, detect the NIC and start attempting to boot.

TODO
====

Serial console support via a pseudo-tty.  (Bochs supports it, just
need to set up a suitable pty).

Packet forwarding/masquerading - document what must be set up.

DHCPD configured to hand out lease for virtual NIC.
